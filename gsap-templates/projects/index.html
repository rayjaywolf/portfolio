<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
    <link
      rel="stylesheet"
      href="https://unpkg.com/mouse-follower@1/dist/mouse-follower.min.css"
    />
    <title>Document</title>
    <style>
      .mf-cursor-media-box {
        filter: url(#svg-distortion-filter);
        border-radius: 0;
      }
      .mf-cursor-media img {
        border-radius: 50%;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="accordion">
        <div class="item item-1">
          <h1>Project 1</h1>
        </div>
        <div class="item item-2">
          <h1>Project 2</h1>
        </div>
        <div class="item item-3">
          <h1>Project 3</h1>
        </div>
        <div class="item item-4">
          <h1>Project 4</h1>
        </div>
        <div class="item item-5">
          <h1>Project 5</h1>
        </div>
      </div>
    </div>

    <svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 463 463"
      style="position: absolute; top: -1px; left: -1px; height: 0; width: 0"
      id="svg-distortion"
    >
      <defs>
        <filter id="svg-distortion-filter">
          <feTurbulence
            type="fractalNoise"
            baseFrequency="0.01 0.003"
            stitchTiles="noStitch"
            numOctaves="1"
            seed="2"
            result="warp"
          ></feTurbulence>
          <feDisplacementMap
            xChannelSelector="R"
            yChannelSelector="G"
            scale="1"
            in="SourceGraphic"
            in2="warp"
          ></feDisplacementMap>
        </filter>
      </defs>
    </svg>

    <script src="https://unpkg.com/mouse-follower@1/dist/mouse-follower.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
    <script>
      var cursor = new MouseFollower({
        skewingMedia: 1,
        skewing: 0,
      });

      const accordion = document.querySelector(".accordion");
      const items = document.querySelectorAll(".item");
      const mf = document.querySelector(".mf-cursor");
      const mfMediaBox = document.querySelector(".mf-cursor-media-box");
      const svgFilter = document.querySelector("#svg-distortion-filter");
      const svgFilterTurbulence = svgFilter.querySelector("feTurbulence");
      const svgFilterDisplacementMap =
        svgFilter.querySelector("feDisplacementMap");

      const makeDisplace = () => {
        const tl = gsap.timeline();
        gsap.killTweensOf(svgFilterDisplacementMap);
        tl.set(
          svgFilterTurbulence,
          {
            attr: { seed: gsap.utils.random(2, 150) },
          },
          0
        );
        tl.to(
          svgFilterDisplacementMap,
          {
            attr: { scale: gsap.utils.random(80, 120) },
            duration: 0.2,
          },
          0
        );
        tl.to(
          svgFilterDisplacementMap,
          {
            attr: { scale: 1 },
            duration: 1.2,
            ease: "expo.out",
          },
          0.2
        );
      };

      Array.from(accordion.children).forEach((item) => {
        item.addEventListener("mouseenter", () => {
          const index = Array.from(accordion.children).indexOf(item);
          cursor.setImg(`/${index + 1}.jpg`);
          mf.style.zIndex = -1;
          makeDisplace();
        });
        item.addEventListener("mouseleave", () => {
          cursor.removeImg();
        });
      });
    </script>
  </body>
</html>
